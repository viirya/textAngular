/*! textAngular-Markdown 2013-10-28 */
var textAngular=angular.module("textAngular",["ngResource"]);textAngular.directive("compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){console.log(d),c.html(d),a(c.contents())(b)})}}),textAngular.directive("textAngular",function(a,b,c,d,e){var f={parse_by_service:function(a,b){var c=e("http://localhost:8080/api"),d=c.save({markdownstr:b},function(){f.compileHtml(a,d.html)})},theme:function(a,b){if(b.disableStyle)return!1;a.theme=b.theme?b.theme:{};var c={resize:"both","overflow-y":"auto","min-height":"300px","text-align":"left",padding:"4px"},d={margin:"0.2em","text-align":"right",overflow:"hidden","border-radius":"3px",display:"inline-block"};a.theme.editor=a.theme.editor?angular.extend(a.theme.editor,c):{background:"#FFFFFF",color:"#5E5E5E",border:"1px solid #C4C4C4",padding:"4px",resize:"both","overflow-y":"auto","min-height":"300px","text-align":"left","border-radius":"3px"},a.theme.toolbar=a.theme.toolbar?angular.extend(a.theme.toolbar,d):{margin:"0.2em","text-align":"right",overflow:"hidden","border-radius":"3px",border:"1px #C4C4C4",display:"inline-block"},a.theme.toolbarItems=a.theme.toolbarItems?a.theme.toolbarItems:{cursor:"pointer",display:"inline-block",padding:"0.2em 0.4em","margin-left":"0em",background:"gray",color:"white","font-size":"14px"},a.theme.insertForm=a.theme.insertForm?a.theme.insertForm:{"text-align":"right",padding:"0.2em"},a.theme.insertFormBtn=a.theme.insertFormBtn?a.theme.insertFormBtn:{"margin-top":"0.2em"}},compileHtml:function(a,c){var d=$("<div>").append(c).html().replace(/(class="(.*?)")|(class='(.*?)')/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/style=("|')(.*?)("|')/g,"");"load"==a.showMark?(a.textAngularModel.text=b.trustAsHtml(d),a.showMark=a.showMarkDefault||!1):a.showMark||(a.textAngularModel.text=b.trustAsHtml(d)),a.$parent.textAngularOpts.textAngularEditors[a.name].html=d},wrapSelection:function(a,b){document.execCommand(a,!1,b)},toolbarFn:{mark:function(a,b){if(a.showMark=!a.showMark,a.showMark){var c=$(b).find(".textAngular-text").html();d(function(){$(b).find(".textAngular-mark").focus()},100)}else{var c=$(b).find(".textAngular-mark").val();d(function(){$(b).find(".textAngular-text").focus()},100)}a.showMark||f.parse_by_service(a,c)},h1:function(){f.wrapSelection("insertText","#text\n")},h2:function(){f.wrapSelection("insertText","##text\n")},h3:function(){f.wrapSelection("insertText","###text\n")},p:function(){f.wrapSelection("insertText","\n")},code:function(){f.wrapSelection("insertText",["\n     code","     code","     code\n\n"].join("\n"))},ul:function(){f.wrapSelection("insertText",["\n* item","* item","* item\n\n"].join("\n"))},ol:function(){f.wrapSelection("insertText",["\n1. item","2. item","3. item\n\n"].join("\n"))},quote:function(){f.wrapSelection("insertText","<BLOCKQUOTE>")},undo:function(){f.wrapSelection("undo",null)},redo:function(){f.wrapSelection("redo",null)},b:function(){f.wrapSelection("insertText","**text**")},justifyLeft:function(){f.wrapSelection("justifyLeft",null)},justifyRight:function(){f.wrapSelection("justifyRight",null)},justifyCenter:function(){f.wrapSelection("justifyCenter",null)},i:function(){f.wrapSelection("insertText","*text*")},clear:function(){f.wrapSelection("FormatBlock","<div>")},insertImage:function(a){return 1==a.inserting?(a.inserting=!1,!1):(a.insert.model="",a.inserting=!0,a.insert.text="Insert Image",a.currentInsert="insertImage",void 0)},insertHtml:function(a){return 1==a.inserting?(a.inserting=!1,!1):(a.insert.model="",a.inserting=!0,a.insert.text="Insert HTML",a.currentInsert="insertHtml",void 0)},createLink:function(a){return 1==a.inserting?(a.inserting=!1,!1):(a.insert.model="",a.inserting=!0,a.insert.text="Make a Link",a.currentInsert="createLink",void 0)}}};return{template:"<div class='textAngular-root' style='text-align:right;'><div class='textAngular-toolbar' ng-style='theme.toolbar'><span ng-repeat='toolbarItem in toolbar' title='{{toolbarItem.title}}' class='textAngular-toolbar-item' ng-style='theme.toolbarItems' ng-mousedown='runToolbar(toolbarItem.name,$event)' unselectable='on' compile='toolbarItem.icon' name='toolbarItem.name'></span></div><form class='textAngular-insert' ng-show='inserting' ng-style='theme.insertForm'><input type='text' ng-model='insert.model' required><div class='textAngular-insert-submit'><button ng-style='theme.insertFormBtn' ng-mousedown='finishInsert();'>{{insert.text}}</button></div></form><textarea ng-show='showMark' class='textAngular-mark' ng-style='theme.editor' ng-model='textAngularModel.mark' style='display: block; width: 100%'></textarea><div contentEditable='true' ng-hide='showMark' class='textAngular-text' ng-style='theme.editor' ng-bind-html='textAngularModel.text' ></div></div>",replace:!0,scope:{},restrict:"A",controller:function(a,b){console.log("Thank you for using textAngular! http://www.textangular.com"),a.insert={},a.finishInsert=function(){f.wrapSelection(a.currentInsert,a.insert.model),a.inserting=!1},a.runToolbar=function(c,d){d.preventDefault(),setTimeout(function(){("mark"==c||a.showMark)&&$(b).find(".textAngular-mark").focus(),f.toolbarFn[c](a,b),"mark"!=c&&f.parse_by_service(a,a.textAngularModel.mark)},50)}},link:function(a,b,c){a.$parent.$watch("textAngularOpts",function(){if(a.$parent.textAngularOpts||console.log("No textAngularOpts config object found in scope! Please create one!"),a.showMark="load",!c.textAngularName)return console.log("No 'text-angular-name' directive found on directve root element. Please add one! "),!1;var b=c.textAngularName;if(a.name=b,a.$parent.textAngularOpts.textAngularEditors||(a.$parent.textAngularOpts.textAngularEditors={}),a.$parent.textAngularOpts.textAngularEditors[b]){var d=a.$parent.textAngularOpts.textAngularEditors[b];a.toolbar=a.$parent.textAngularOpts.textAngularEditors[b].toolbar}else{a.$parent.textAngularOpts.textAngularEditors[b]={};var d=a.$parent.textAngularOpts;a.toolbar=a.$parent.textAngularOpts.toolbar}a.$parent.$watch('textAngularOpts.textAngularEditors["'+b+'"].mark',function(b,c){$(":focus").parents(".textAngular-root")[0]||(a.textAngularModel.mark=c)},!0),f.theme(a,d),a.textAngularModel={},a.textAngularModel.mark=d.mark,f.parse_by_service(a,d.mark)})}}});